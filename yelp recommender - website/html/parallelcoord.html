<!doctype html>

<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">

  <style>
    #ex1Slider .slider-selection {
      background: #BABABA;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="../lib/css/d3.parcoords.css">
  <link rel="stylesheet" type="text/css" href="../lib/css/style.css">
  <script src="../lib/js/d3.js"></script>
  <script src="../lib/js/d3.svg.multibrush.js"></script>
  <script src="../lib/js/d3.parcoords.js"></script>
  <title>Yelp Attributes Visualiser</title>
</head>

<body>


  <div id="yelpPC" class="parcoords"></div>

  <script>
    var factor = .75;
    var height = 480 * factor;
    var width = 640 * 2 * factor;

    paraCoordElem = document.getElementById('yelpPC');
    paraCoordElem.style.width = width + 'px';
    paraCoordElem.style.height = height + 'px';

    var paracoordOnTrigger = function (biz_Id) {

      var yelpcoord = d3.parcoords()("#yelpPC");
      d3.csv('../data/attributes.csv', function (data) {

        objectKeys = Object.keys(data[0]);
        primaryAttr = objectKeys[0];
        console.log(biz_Id);

        //Create the Scale we will use for the Axis
        var axisScale = d3.scale.linear()
          .domain([1, 0])
          .range([0, height - 35]);

        //Axis for name column
        var axisScaleName = d3.scale.ordinal()
          .range([0, height - 35]);

        // linear color scale
        var colorScale = d3.scale.linear()
          .domain([0, 1])
          .range(["red", "lime"])
          .interpolate(d3.interpolateLab);

        yelpcoord
          .width(width)
          .height(height)
          .dimensions(
          {
            'Restaurant':
            {
              title: primaryAttr,
              orient: 'left',
              type: 'string',
              tickPadding: 5,
              innerTickSize: 10,
              index: 0
            },
            'Ambience': {              
              type: 'number',
              yscale: axisScale
            },
            'Food': {
              type: 'number',
              yscale: axisScale
            },
            'Service': {
              type: 'number',
              yscale: axisScale
            },
            'Neighborhood': {
              type: 'number',
              yscale: axisScale
            },
            'Average': {
              type: 'number',
              index: 0,
              yscale: axisScale
            }
          })
          .data(data)
          .color(function (d) { return colorScale(d[objectKeys[6]]); })
          .animationTime(1000)
          .data(data)
          .alpha(.6)
          .alphaOnBrushed(0.33)
          .mode("queue")
          .rate(1)
          .render()
          .margin({ top: 25, left: 30, right: 0, bottom: 10 })
          .reorderable()
          .brushMode("1D-axes-multi")
          .brushedColor(
          //"navy"
          "#48A4FF"
          );

        yelpcoord.svg.selectAll("text")
          .style("font", "9px sans-serif");

        yelpcoord.svg.selectAll("text.label")
          .attr("transform", "translate(0,-10)")
          .style("font", "12px sans-serif")
          .style("font-weight", "bold");
      });
    };


    //Download the attribute comparision image
    function downloadScreenshot() {

      var callback = function (canvas) {
        // Download the image
        var download = document.createElement("a");
        download.href = canvas.toDataURL("image/png");
        download.download = "parallel-coordinate.png";
        download.click();
      };
      yelpcoord.mergeParcoords(callback);
    }

    if(window.jQuery)
      $( document ).ready(function() {
        //Download on button click
          downloadButton = document.getElementById("downloadImage");
          if (downloadButton)
            downloadButton.onclick = downloadScreenshot;
          
          $("#prlplotTrigger").click(function() { paracoordOnTrigger('b');});
      });
    else
      paracoordOnTrigger('a')
  </script>
</body>